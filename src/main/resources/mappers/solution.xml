<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.winiaaid.domain.solution.SolutionRepository">

    <select id="findSolutionListByProductCategoryCode" parameterType="HashMap" resultType="com.project.winiaaid.domain.solution.Solution">
        SELECT
            st.solution_title,
            st.solution_content,
            st.create_date,

            stt.solution_name,

            wpd.product_detail_name,

            wpm.product_category_name,

            tct.total_count
        FROM
            solution_product_table spt
            LEFT OUTER JOIN solution_table st ON(st.solution_code = spt.solution_code)
            LEFT OUTER JOIN solution_type_table stt ON(stt.solution_type_code = st.solution_type_code)
            LEFT OUTER JOIN winia_product_dtl wpd ON(wpd.product_code = spt.product_code)
            LEFT OUTER JOIN winia_product_mst wpm ON(wpm.product_category_code = wpd.product_category_code)
            LEFT OUTER JOIN (SELECT
                                COUNT(*) AS total_count
                            FROM
                                solution_table st
                                LEFT OUTER JOIN solution_product_table spt ON(spt.solution_code = st.solution_code)
                                LEFT OUTER JOIN winia_product_dtl wpd ON(wpd.product_code = spt.product_code)
                                LEFT OUTER JOIN winia_product_mst wpm ON(wpm.product_category_code = wpd.product_category_code)
                            WHERE
                                wpm.product_category_code = #{keyCode}
                                AND st.solution_board_type = #{solution_board_type}
                                <if test="solution_type_code != 1">
                                    AND st.solution_type_code = #{solution_type_code}
                                </if>
                                <if test="keyword != null">
                                    AND (st.solution_title like concat('%', #{keyword}, '%')
                                    OR st.solution_content like concat('%', #{keyword}, '%'))
                                </if>
                                ) tct ON (1 = 1)
        WHERE
            wpm.product_category_code = #{keyCode}
            AND st.solution_board_type = #{solution_board_type}
            <if test="solution_type_code != 1">
                AND st.solution_type_code = #{solution_type_code}
            </if>
            <if test="keyword != null">
                AND (st.solution_title like concat('%', #{keyword}, '%')
                OR st.solution_content like concat('%', #{keyword}, '%'))
            </if>
        GROUP BY
            spt.views desc;
    </select>

    <select id="findSolutionListByProductGroupCode" parameterType="HashMap" resultType="com.project.winiaaid.domain.solution.Solution">
        SELECT
            st.solution_title,
            st.solution_content,
            st.create_date,

            stt.solution_name,

            wpd.product_detail_name,

            wpm.product_category_name,

            tct.total_count
        FROM
            solution_product_table spt
            LEFT OUTER JOIN solution_table st ON(st.solution_code = spt.solution_code)
            LEFT OUTER JOIN solution_type_table stt ON(stt.solution_type_code = st.solution_type_code)
            LEFT OUTER JOIN winia_product_dtl wpd ON(wpd.product_code = spt.product_code)
            LEFT OUTER JOIN winia_product_mst wpm ON(wpm.product_category_code = wpd.product_category_code)
            LEFT OUTER JOIN (SELECT
                                COUNT(*) AS total_count
                            FROM
                                solution_table st
                                LEFT OUTER JOIN solution_product_table spt ON(spt.solution_code = st.solution_code)
                                LEFT OUTER JOIN winia_product_dtl wpd ON(wpd.product_code = spt.product_code)
                                LEFT OUTER JOIN winia_product_mst wpm ON(wpm.product_category_code = wpd.product_category_code)
                            WHERE
                                wpm.product_group = #{keyCode}
                                AND st.solution_board_type = #{solution_board_type}
                                AND wpm.company_code = #{company_code}
                                <if test="solution_type_code != 1">
                                    AND st.solution_type_code = #{solution_type_code}
                                </if>
                                <if test="keyword != null">
                                    AND (st.solution_title like concat('%', #{keyword}, '%')
                                    OR st.solution_content like concat('%', #{keyword}, '%'))
                                </if>
                                ) tct ON (1 = 1)
        WHERE
            wpm.product_group = #{keyCode}
            AND st.solution_board_type = #{solution_board_type}
            AND wpm.company_code = #{company_code}
            <if test="solution_type_code != 1">
                AND st.solution_type_code = #{solution_type_code}
            </if>
            <if test="keyword != null">
                AND (st.solution_title like concat('%', #{keyword}, '%')
                OR st.solution_content like concat('%', #{keyword}, '%'))
            </if>
        GROUP BY
            spt.views desc;
    </select>

    <select id="findSolutionListByProductCode" parameterType="HashMap" resultType="com.project.winiaaid.domain.solution.Solution">
        SELECT
            st.solution_title,
            st.solution_content,
            st.create_date,

            stt.solution_name,

            wpd.product_detail_name,

            wpm.product_category_name,

            tct.total_count
        FROM
            solution_product_table spt
            LEFT OUTER JOIN solution_table st ON(st.solution_code = spt.solution_code)
            LEFT OUTER JOIN solution_type_table stt ON(stt.solution_type_code = st.solution_type_code)
            LEFT OUTER JOIN winia_product_dtl wpd ON(wpd.product_code = spt.product_code)
            LEFT OUTER JOIN winia_product_mst wpm ON(wpm.product_category_code = wpd.product_category_code)
            LEFT OUTER JOIN (SELECT
                                COUNT(*) AS total_count
                            FROM
                                solution_table st
                                LEFT OUTER JOIN solution_product_table spt ON(spt.solution_code = st.solution_code)
                            WHERE
                                spt.product_code = #{keyCode}
                                AND st.solution_board_type = #{solution_board_type}
                                <if test="solution_type_code != 1">
                                    AND st.solution_type_code = #{solution_type_code}
                                </if>
                                <if test="keyword != null">
                                    AND (st.solution_title like concat('%', #{keyword}, '%')
                                    OR st.solution_content like concat('%', #{keyword}, '%'))
                                </if>
                                ) tct ON (1 = 1)
        WHERE
            spt.product_code = #{keyCode}
            AND st.solution_board_type = #{solution_board_type}
            <if test="solution_type_code != 1">
                AND st.solution_type_code = #{solution_type_code}
            </if>
            <if test="keyword != null">
                AND (st.solution_title like concat('%', #{keyword}, '%')
                OR st.solution_content like concat('%', #{keyword}, '%'))
            </if>
        GROUP BY
            spt.views desc;
    </select>

    <select id="findAllSolutionListByCompanyCode" parameterType="HashMap" resultType="com.project.winiaaid.domain.solution.Solution">
        SELECT
            spt.views,

            st.solution_title,
            st.solution_content,
            st.create_date,

            stt.solution_name,

            wpd.product_detail_name,

            wpm.product_category_name,

            tct.total_count
        FROM
            solution_product_table spt
            LEFT OUTER JOIN solution_table st ON(st.solution_code = spt.solution_code)
            LEFT OUTER JOIN solution_type_table stt ON(stt.solution_type_code = st.solution_type_code)
            LEFT OUTER JOIN winia_product_dtl wpd ON(wpd.product_code = spt.product_code)
            LEFT OUTER JOIN winia_product_mst wpm ON(wpm.product_category_code = wpd.product_category_code)
            LEFT OUTER JOIN (SELECT
                                COUNT(*) AS total_count
                            FROM
                                solution_table st
                                LEFT OUTER JOIN solution_product_table spt ON(spt.solution_code = st.solution_code)
                                LEFT OUTER JOIN winia_product_dtl wpd ON(wpd.product_code = spt.product_code)
                                LEFT OUTER JOIN winia_product_mst wpm ON(wpm.product_category_code = wpd.product_category_code)
                            WHERE
                                wpm.company_code = #{company_code}
                                AND st.solution_board_type = #{solution_board_type}
                                <if test="keyword != null">
                                    AND (st.solution_title like concat('%', #{keyword}, '%')
                                    OR st.solution_content like concat('%', #{keyword}, '%'))
                                </if>) tct ON (1 = 1)
        WHERE
            wpm.company_code = #{company_code}
            AND st.solution_board_type = #{solution_board_type}
            <if test="keyword != null">
                AND (st.solution_title like concat('%', #{keyword}, '%')
                OR st.solution_content like concat('%', #{keyword}, '%'))
            </if>
        GROUP BY
            spt.views desc;
    </select>
</mapper>